/*******************************************************************************
 * Copyright (C) 2020-, Xinje Electronic Co., Ltd.
 * All rights reserved.
 *
 * Name     : StirrerView.cpp
 * Author   : TangYao
 * Date     : 2021/02/07
 * Descript : 函数画布控件绘制类
 * Version  : 0.1
 * modify   :
 *          :
 *******************************************************************************/
#include "GraphicDrawHandle.h"
#include "stdafx.h"
#include "GFuncView.h"
#include "GFuncModel.h"
#include "UIApi.h"
using namespace Project;
namespace UI
{
	GFuncView::GFuncView(int x, int y, int w, int h)
		: HMIBaseView(x, y, w, h), CurType(DCMapDefault){

	}

	GFuncView::~GFuncView() {

	}

	void GFuncView::draw() {
		shared_ptr<GFuncModel> model = BaseView.GetModel<GFuncModel>();
		//shared_ptr<GFuncControl> ctrl = BaseView.GetControl<GFuncControl>();
		int Finx = model->GFuncUnit.X + model->GFuncUnit.OffX;
		int Finy = model->GFuncUnit.Y + model->GFuncUnit.OffY;
		GraphicDrawHandle::PushClip(Finx, Finy, model->GFuncUnit.Width, model->GFuncUnit.Height);
		switch (CurType)
		{
		case DCMapClear:
		{
			fl_color(RGBColor(model->GFuncUnit.BackColor));
			// 绘制画布背景颜色
			fl_rectf(Finx, Finy, model->GFuncUnit.Width, model->GFuncUnit.Height);
			break;
		}
		case DCMapSetBackColor:
		{
			fl_color(RGBColor(Params[0]));
			// 绘制画布背景颜色
			fl_rectf(Finx, Finy, model->GFuncUnit.Width, model->GFuncUnit.Height);
			break;
		}
		case DCMapDrawLine:
		{
			fl_line_style(0, Params[4]);
			fl_color(RGBColor(Params[5]));
			// 绘制线条
			fl_line(Finx + Params[0],
				Finy + Params[1],
				Finx + Params[2],
				Finy + Params[3]);
			break;
		}
		case DCMapDrawRect:
		{
			//fillrect
			if (Params[6])
			{
				fl_color(RGBColor(Params[7]));
				fl_rectf(Finx + Params[0],Finy + Params[1], Params[2], Params[3]);
			}
			if (Params[4] > 0) {
				// 设置线条样式
				fl_line_style(0, Params[4]);
				// 设置线条颜色
				fl_color(RGBColor(Params[5]));
				// 绘制线条
				fl_rect(Finx + Params[0],Finy + Params[1], Params[2], Params[3]);
			}
			break;
		}
		case DCMapDrawCircle:
		{
			if (Params[5])
			{
				// 设置填充颜色
				fl_color(RGBColor(Params[6]));
				// 填充内部
				fl_pie(Finx + Params[0], Finy + Params[1],Params[2] * 2,Params[2] * 2, 0, 360);
			}
			// 绘制边框
			if (Params[3] > 0) {
				// 设置线条样式
				fl_line_style(0, Params[3]);
				// 设置线条颜色
				fl_color(RGBColor(Params[4]));
				// 绘制边框
				fl_arc(Finx + Params[0], Finy + Params[1], Params[2] * 2, Params[2] * 2, 0, 360);
			}
			break;
		}
		case DCMapDrawEllipse:
		{
			// 是否填充
			if (Params[6])
			{
				// 设置填充颜色
				fl_color(RGBColor(Params[7]));
				// 填充内部
				fl_pie(Finx + Params[0], Finy + Params[1],Params[2] * 2,Params[3] * 2, 0, 360);
			}
			// 绘制边框
			if (Params[4] > 0) {
				// 设置线条样式
				fl_line_style(0, Params[4]);
				// 设置线条颜色
				fl_color(RGBColor(Params[5]));
				// 绘制边框
				fl_arc(Finx + Params[0], Finy + Params[1],Params[2] * 2,Params[3] * 2, 0, 360);
			}
			break;
		}
		case DCMapDrawCircleArc:
		{
			// 绘制边框
			if (Params[3] > 0) {
				// 设置线条样式
				fl_line_style(0, Params[3]);
				// 设置线条颜色
				fl_color(RGBColor(Params[4]));
				// 绘制边框
				fl_arc(Finx + Params[0], Finy + Params[1],
					Params[2] * 2,
					Params[2] * 2, Params[5], Params[6]);
			}
			break;
		}
		case DCMapDrawEllipseArc:
		{
			if (Params[4] > 0) {
				// 设置线条样式
				fl_line_style(0, Params[4]);
				// 设置线条颜色
				fl_color(RGBColor(Params[5]));
				// 绘制边框
				fl_arc(Finx + Params[0], Finy + Params[1],
					Params[2] * 2,
					Params[3] * 2, Params[6], Params[7]);
			}
			break;
		}
		}
		fl_pop_clip();
		/*shared_ptr<GFuncModel> model = BaseView.GetModel<GFuncModel>();
		switch (model->GFuncUnit.FuncId)
		{
		case Project::DrawFunc::DCMapClear: 
		{
			GraphicDrawHandle::PushClip(model->GFuncUnit.X, 
						 model->GFuncUnit.Y,
						 model->GFuncUnit.Width, 
						 model->GFuncUnit.Height);
			// 设置原始背景色
			Fl_Color originColor = fl_rgb_color(255, 255, 255);
			fl_color(originColor);
			// 绘制画布背景颜色
			fl_rectf(model->GFuncUnit.X, 
					 model->GFuncUnit.Y, 
					 model->GFuncUnit.Width, 
					 model->GFuncUnit.Height);
			fl_pop_clip();
			break;
		}	
		case Project::DrawFunc::DCMapSetBackColor:
		{
			GraphicDrawHandle::PushClip(model->GFuncUnit.X, 
						 model->GFuncUnit.Y,
						 model->GFuncUnit.Width, 
						 model->GFuncUnit.Height);
			// 设置背景颜色
			Fl_Color backColor = fl_rgb_color(model->GFuncUnit.BackColor.R,
											  model->GFuncUnit.BackColor.G,
											  model->GFuncUnit.BackColor.B);
			fl_color(backColor);
			// 绘制画布背景颜色
			fl_rectf(model->GFuncUnit.X, 
					 model->GFuncUnit.Y, 
					 model->GFuncUnit.Width, 
					 model->GFuncUnit.Height);
			fl_pop_clip();
			break;
		}
		case Project::DrawFunc::DCMapDrawLine:
		{
			GraphicDrawHandle::PushClip(model->GFuncUnit.X,
						 model->GFuncUnit.Y,
						 model->GFuncUnit.Width,
						 model->GFuncUnit.Height);
			// 绘制线条
			if (model->GFuncUnit.LineWidth > 0) {
				// 设置线条样式
				fl_line_style(0, model->GFuncUnit.LineWidth);
				// 设置线条颜色
				Fl_Color lineColor = fl_rgb_color(model->GFuncUnit.LineColor.R,
												  model->GFuncUnit.LineColor.G,
												  model->GFuncUnit.LineColor.B);
				fl_color(lineColor);
				// 绘制线条
				fl_line(model->GFuncUnit.X + model->GFuncUnit.GX,
						model->GFuncUnit.Y + model->GFuncUnit.GY,
						model->GFuncUnit.X + model->GFuncUnit.GX + model->GFuncUnit.GW,
						model->GFuncUnit.Y + model->GFuncUnit.GY + model->GFuncUnit.GH);
			}
			fl_pop_clip();
			break;
		}	
		case Project::DrawFunc::DCMapDrawRect:
		{
			GraphicDrawHandle::PushClip(model->GFuncUnit.X,
						 model->GFuncUnit.Y,
						 model->GFuncUnit.Width,
						 model->GFuncUnit.Height);
			// 是否填充
			if (model->GFuncUnit.FillRect) {
				// 设置填充颜色
				Fl_Color fillColor = fl_rgb_color(model->GFuncUnit.FillColor.R,
												  model->GFuncUnit.FillColor.G,
												  model->GFuncUnit.FillColor.B);
				fl_color(fillColor);
				// 填充内部
				fl_rectf(model->GFuncUnit.X + model->GFuncUnit.GX,
						 model->GFuncUnit.Y + model->GFuncUnit.GY,
						 model->GFuncUnit.GW,
						 model->GFuncUnit.GH);
			}
			// 绘制边框
			if (model->GFuncUnit.LineWidth > 0) {
				// 设置线条样式
				fl_line_style(0, model->GFuncUnit.LineWidth);
				// 设置线条颜色
				Fl_Color lineColor = fl_rgb_color(model->GFuncUnit.LineColor.R,
												  model->GFuncUnit.LineColor.G,
												  model->GFuncUnit.LineColor.B);
				// 绘制边框
				fl_rect(model->GFuncUnit.X + model->GFuncUnit.GX,
						model->GFuncUnit.Y + model->GFuncUnit.GY,
						model->GFuncUnit.GW,
						model->GFuncUnit.GH, lineColor);
			}
			fl_pop_clip();
			break;
		}	
		case Project::DrawFunc::DCMapDrawCircle:
		case Project::DrawFunc::DCMapDrawEllipse:
		{
			GraphicDrawHandle::PushClip(model->GFuncUnit.X,
						 model->GFuncUnit.Y,
						 model->GFuncUnit.Width,
						 model->GFuncUnit.Height);
			// 是否填充
			if (model->GFuncUnit.FillRect)
			{
				// 设置填充颜色
				Fl_Color fillColor = fl_rgb_color(model->GFuncUnit.FillColor.R,
												  model->GFuncUnit.FillColor.G,
												  model->GFuncUnit.FillColor.B);
				fl_color(fillColor);
				// 填充内部
				fl_pie(model->GFuncUnit.X + model->GFuncUnit.GX - model->GFuncUnit.GW,
					   model->GFuncUnit.Y + model->GFuncUnit.GY - model->GFuncUnit.GH,
					   model->GFuncUnit.GW * 2,
					   model->GFuncUnit.GH * 2, 0, 360);
			}
			// 绘制边框
			if (model->GFuncUnit.LineWidth > 0) {
				// 设置线条样式
				fl_line_style(0, model->GFuncUnit.LineWidth);
				// 设置线条颜色
				Fl_Color lineColor = fl_rgb_color(model->GFuncUnit.LineColor.R,
												  model->GFuncUnit.LineColor.G,
												  model->GFuncUnit.LineColor.B);
				fl_color(lineColor);
				// 绘制边框
				fl_arc(model->GFuncUnit.X + model->GFuncUnit.GX - model->GFuncUnit.GW,
					   model->GFuncUnit.Y + model->GFuncUnit.GY - model->GFuncUnit.GH,
					   model->GFuncUnit.GW * 2, 
					   model->GFuncUnit.GH * 2, 0, 360);
			}
			fl_pop_clip();
			break;
		}
		case Project::DrawFunc::DCMapDrawCircleArc:
		case Project::DrawFunc::DCMapDrawEllipseArc:
		{
			GraphicDrawHandle::PushClip(model->GFuncUnit.X,
						 model->GFuncUnit.Y,
						 model->GFuncUnit.Width,
						 model->GFuncUnit.Height);
			// 绘制边框
			if (model->GFuncUnit.LineWidth > 0) {
				// 设置线条样式
				fl_line_style(0, model->GFuncUnit.LineWidth);
				// 设置线条颜色
				Fl_Color lineColor = fl_rgb_color(model->GFuncUnit.LineColor.R,
												  model->GFuncUnit.LineColor.G,
												  model->GFuncUnit.LineColor.B);
				fl_color(lineColor);
				// 绘制边框
				fl_arc(model->GFuncUnit.X + model->GFuncUnit.GX - model->GFuncUnit.GW,
					   model->GFuncUnit.Y + model->GFuncUnit.GY - model->GFuncUnit.GH,
					   model->GFuncUnit.GW * 2,
					   model->GFuncUnit.GH * 2,
					   model->GFuncUnit.StartAngle,
					   model->GFuncUnit.EndAngle);
			}
			fl_pop_clip();
			break;
		}
		default:
			break;
		}*/
	}
	void GFuncView::AddrDrawTask(Project::DrawFunc cmdtype, Project::ParamType * pararms, int pararmcount)
	{
		CurType = cmdtype;
		memset(Params, 0, sizeof(Project::ParamType)*10);
		if (pararms&&pararmcount)
		{
			memcpy(Params, pararms, pararmcount * sizeof(Project::ParamType));
		}
		
	}
}